ç®€çŸ­ç­”æ¡ˆï¼š
å¦‚æœæœåŠ¡ç«¯åœ¨å®¢æˆ·ç«¯è¿˜æ²¡è°ƒç”¨ CloseSend()ï¼ˆå³è¿˜æ²¡å‘é€å®Œæ‰€æœ‰æ¶ˆæ¯ï¼‰æ—¶å°±æå‰è°ƒç”¨ SendAndClose() æˆ–è¿”å›å“åº”ï¼Œä¼šè§¦å‘ï¼š

å®¢æˆ·ç«¯æ”¶åˆ° EOF æˆ–é”™è¯¯

å®¢æˆ·ç«¯åç»­çš„ Send() è°ƒç”¨å°†å¤±è´¥ï¼ˆä¼šè¿”å› rpc error: code = Unavailable æˆ– EOFï¼‰

ğŸ§  èƒŒåæœºåˆ¶åŸç†ï¼š
åœ¨å®¢æˆ·ç«¯æµå¼è°ƒç”¨ä¸­ï¼ŒåŸºæœ¬çš„è°ƒç”¨é¡ºåºæ˜¯ï¼š

go
å¤åˆ¶
ç¼–è¾‘
stream, _ := client.MyClientStreamingRPC(ctx)

stream.Send(req1)
stream.Send(req2)
// ...
stream.CloseSend()

resp, err := stream.CloseAndRecv()
è€Œåœ¨æœåŠ¡ç«¯ï¼Œé€šå¸¸ä½ è¿™æ ·å†™ï¼š

go
å¤åˆ¶
ç¼–è¾‘
func (s *myService) MyClientStreaming(stream pb.MyService_MyClientStreamingServer) error {
    for {
        req, err := stream.Recv()
        if err == io.EOF {
            return stream.SendAndClose(&pb.Response{...})
        }
        // å¤„ç† req
    }
}
âš ï¸ å¦‚æœæœåŠ¡ç«¯åœ¨ Recv() è¿˜æ²¡è¯»å®Œå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚å°±è¿”å›äº†å“åº”ï¼š
go
å¤åˆ¶
ç¼–è¾‘
// æœåŠ¡ç«¯ææ—©è¿”å›äº†å“åº”
return stream.SendAndClose(&pb.Response{...})
æ­¤æ—¶ï¼š

æœåŠ¡ç«¯ä¼šä¸»åŠ¨å…³é—­è¿™ä¸ª stream

å®¢æˆ·ç«¯çš„ Send() ä¼šå¤±è´¥ï¼ˆè¿”å› errorï¼‰

å¦‚æœå®¢æˆ·ç«¯ç»§ç»­è°ƒç”¨ Send()ï¼Œä¼šçœ‹åˆ°é”™è¯¯å¦‚ï¼š

vbnet
å¤åˆ¶
ç¼–è¾‘
rpc error: code = Unavailable desc = transport is closing
ğŸ¯ å®é™…æ•ˆæœï¼ˆæ€»ç»“è¡¨æ ¼ï¼‰
å®¢æˆ·ç«¯è¡Œä¸º	æœåŠ¡ç«¯æå‰å“åº”åä¼šå‘ç”Ÿä»€ä¹ˆ
Send()	è¿”å›é”™è¯¯ï¼ˆstream å·²è¢«å…³é—­ï¼‰
CloseSend()	ä¸ä¼šç”Ÿæ•ˆï¼Œstream å·²å…³é—­
CloseAndRecv()	å¯æ­£å¸¸æ¥æ”¶å“åº”ï¼ˆå¦‚æœæœªæå‰ errorï¼‰

âœ… æ­£ç¡®çš„åšæ³•ï¼ˆæ ¹æ®åœºæ™¯å†³å®šï¼‰ï¼š
âœ… å¦‚æœä½ å¸Œæœ›æœåŠ¡ç«¯æ ¹æ®éƒ¨åˆ†æ¶ˆæ¯å°±å“åº”ï¼š
è¿™æ˜¯åˆæ³•çš„ï¼Œä½†è¦é€šçŸ¥å®¢æˆ·ç«¯ä¸è¦å†å‘äº†

å®¢æˆ·ç«¯å¿…é¡»èƒ½å¤„ç† Send() è¿”å›é”™è¯¯

æˆ–è€…ä½ å®šä¹‰å¥½åè®®ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯æœ€å¤šåªå‘é€ N æ¡ï¼Œä¹‹åå°±ä¸å‘äº†

âŒ ä¸å»ºè®®çš„åšæ³•ï¼š
æœåŠ¡ç«¯ç›²ç›®ææ—© SendAndClose()ï¼Œå´ä¸æ¸…æ¥šå®¢æˆ·ç«¯æ˜¯å¦å‘é€å®Œæˆ

ä¼šå¯¼è‡´å®¢æˆ·ç«¯ä¸šåŠ¡ä»£ç å‡ºé”™æˆ–äº§ç”Ÿå¼‚å¸¸è¡Œä¸º

âœ… å®æˆ˜å»ºè®®
å®¢æˆ·ç«¯åœ¨å‘é€å‰åˆ¤æ–­æ˜¯å¦æ”¶åˆ°å“åº”ï¼ˆæ¯”å¦‚åŠ ä¸ªçŠ¶æ€æ ‡å¿—ï¼‰

æœåŠ¡ç«¯æ”¶åˆ°è¶³å¤Ÿè¯·æ±‚åå¯ä¸»åŠ¨è¿”å›ï¼Œä½†è¦è®¾è®¡æ¸…æ™°çš„åè®®

ä½¿ç”¨ context.Context å®ç° cancellation æœºåˆ¶

ğŸ“Œ ç¤ºä¾‹ï¼šå®¢æˆ·ç«¯åº”å¤„ç†å‘é€å¤±è´¥
go
å¤åˆ¶
ç¼–è¾‘
stream, err := client.MyStream(ctx)
if err != nil {
    // handle error
}

for _, req := range requests {
    if err := stream.Send(req); err != nil {
        log.Printf("send failed: %v", err)
        break // åœæ­¢å‘é€
    }
}

// æ­£å¸¸æˆ–æå‰å¤±è´¥éƒ½å¯ä»¥å°è¯•æ¥æ”¶å“åº”
resp, err := stream.CloseAndRecv()
