ç®€çŸ­ç»“è®ºï¼š
ä¸ä¼šè¦†ç›–ã€‚

grpc.WithDefaultServiceConfig(...) åªä½œä¸ºâ€œå…œåº•é…ç½®â€ï¼Œå½“è§£æå™¨æ²¡æœ‰æä¾› ServiceConfig æ—¶æ‰ä¼šä½¿ç”¨ã€‚

ğŸ§  æ·±å…¥è§£é‡Šï¼š
gRPC çš„æœåŠ¡é…ç½® (ServiceConfig) æ¥æºæœ‰ä¸¤ä¸ªæ¸ é“ï¼š

1. è§£æå™¨ï¼ˆresolverï¼‰åŠ¨æ€æä¾›çš„é…ç½®
ç”±ä½ åœ¨è‡ªå®šä¹‰ resolver.Resolver ä¸­é€šè¿‡ï¼š

go
å¤åˆ¶
ç¼–è¾‘
r.cc.UpdateState(resolver.State{
    Addresses:     []resolver.Address{...},
    ServiceConfig: parsedConfig,
})
ä¸»åŠ¨æ¨é€ç»™ gRPC çš„å®¢æˆ·ç«¯è¿æ¥ã€‚

âœ… ä¼˜å…ˆçº§æ›´é«˜ã€‚

2. Dial æ—¶è®¾ç½®çš„é»˜è®¤é…ç½®
go
å¤åˆ¶
ç¼–è¾‘
grpc.WithDefaultServiceConfig(`{"loadBalancingPolicy":"round_robin"}`)
è¿™æ˜¯ä¸€ä¸ª é»˜è®¤å€¼ï¼Œå½“ resolver æ²¡æœ‰æä¾›é…ç½® æ—¶ï¼ŒgRPC ä¼šä½¿ç”¨å®ƒã€‚

ğŸ¯ ä¼˜å…ˆçº§é€»è¾‘å¦‚ä¸‹ï¼ˆå®˜æ–¹è¡Œä¸ºï¼‰ï¼š
æ¥æº	æ˜¯å¦è¦†ç›–	è¯´æ˜
resolver.State.ServiceConfig	âœ… ä¼˜å…ˆä½¿ç”¨	åŠ¨æ€æœåŠ¡ç«¯é…ç½®ï¼Œæ›´å…·æƒå¨æ€§
grpc.WithDefaultServiceConfig(...)	ä»…å½“ resolver æœªæä¾›é…ç½®æ—¶ç”Ÿæ•ˆ	fallback è¡Œä¸º

âœ… ç¤ºä¾‹è¡Œä¸ºå¯¹æ¯”ï¼š
âœ… æƒ…å†µ 1ï¼šresolver æä¾› ServiceConfig
go
å¤åˆ¶
ç¼–è¾‘
r.cc.UpdateState(resolver.State{
    Addresses: []resolver.Address{...},
    ServiceConfig: internalparsedSC, // from json
})
ğŸ‘‰ å¿½ç•¥ WithDefaultServiceConfig(...)ï¼Œä½¿ç”¨ resolver çš„é…ç½®ã€‚

âœ… æƒ…å†µ 2ï¼šresolver ä¸æä¾› ServiceConfig
go
å¤åˆ¶
ç¼–è¾‘
r.cc.UpdateState(resolver.State{
    Addresses: []resolver.Address{...},
    // æ²¡æœ‰ ServiceConfig
})
ğŸ‘‰ ä½¿ç”¨ä½ åœ¨ Dial ä¸­ä¼ å…¥çš„é»˜è®¤å€¼ï¼Œä¾‹å¦‚ round_robinã€‚

ğŸ§ª éªŒè¯æ–¹æ³•
ä½ å¯ä»¥é€šè¿‡ grpc.WithDisableServiceConfig() å…³é—­æ‰€æœ‰ ServiceConfigï¼Œç„¶åè§‚å¯Ÿæ˜¯å¦è´Ÿè½½å‡è¡¡å™¨è¿˜ä¼šç”Ÿæ•ˆï¼Œæ¥ç¡®è®¤ä½ ä¼ å…¥çš„é…ç½®æ˜¯ fallback è€Œéè¦†ç›–ï¼š

go
å¤åˆ¶
ç¼–è¾‘
grpc.Dial(
  "example:cluster@callee",
  grpc.WithTransportCredentials(insecure.NewCredentials()),
  grpc.WithDisableServiceConfig(),
)
å¦‚æœæ­¤æ—¶ round_robin ä¸å†ç”Ÿæ•ˆï¼Œå°±è¯´æ˜ä½ åŸæœ¬ä¾èµ–çš„æ˜¯ resolver çš„é…ç½®ã€‚

âœ… æ€»ç»“
é—®é¢˜	ç­”æ¡ˆ
grpc.WithDefaultServiceConfig() ä¼šä¸ä¼šè¦†ç›– r.cc.UpdateState() çš„ ServiceConfigï¼Ÿ	âŒ ä¸ä¼šã€‚åªæœ‰åœ¨è§£æå™¨æ²¡æä¾›é…ç½®æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚
è°ä¼˜å…ˆçº§æ›´é«˜ï¼Ÿ	âœ… Resolver çš„ UpdateState é…ç½®ä¼˜å…ˆçº§æ›´é«˜
